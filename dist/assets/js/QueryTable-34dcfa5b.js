var t,e,o;import{z as s,c as r,t as n,A as i,B as l,_ as a}from"./index-df51bfa3.js";import"./dayjs-70c6b0b9.js";import"./lodash-e3f0fdcb.js";import{bf as p,d as u,bd as m,a3 as c,e as d,$ as j,w as f,k as h,R as g,o as y,P as v,ab as _,Q as B,M as b,u as x,T as w,ai as S,aq as A,W as C,c as k,a9 as $,J as M,F as z}from"./@vue-2b5461a3.js";import"./nprogress-61860a65.js";import{_ as F}from"./Column.vue_vue_type_script_name_Column_setup_true_lang-08309ecb.js";import{n as R,a as T}from"./_utils-79545bed.js";import{g as q,a as E}from"./_utils-931b8acf.js";import{d as P}from"./_config-0a862e30.js";import"./element-plus-568f2232.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-2ec33eb0.js";import"./@element-plus-df896130.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./qs-349681aa.js";import"./call-bind-2df1f9b5.js";import"./get-intrinsic-176af07e.js";import"./es-errors-c8ed318b.js";import"./has-symbols-456daba2.js";import"./has-proto-c2a23985.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-af5653fd.js";import"./define-data-property-80a6b8d7.js";import"./es-define-property-c2edbfb6.js";import"./gopd-991ce5b0.js";import"./has-property-descriptors-52e43c9d.js";import"./side-channel-4fcbcfeb.js";import"./object-inspect-1fd817f8.js";import"./axios-b9284f1b.js";import"./pinia-5cbb4d0f.js";import"./mock-281f81b0.js";import"./mockjs-21e11712.js";import"./vue-router-27db6c8e.js";import"./vite-plugin-mock-fcfbfb18.js";import"./path-to-regexp-83a43451.js";import"./vue-i18n-aaa7cda4.js";import"./@intlify-34459bb4.js";import"./xlsx-8a748b86.js";import"./GroupBtns-baf5df96.js";import"./index-ab647bfb.js";import"./UserInfo-1d530967.js";import"./dict-map-b95c54a5.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-170fc1f8.js";import"./ImportPopup-34a61de7.js";const G=a(u({name:"QueryTable",__name:"QueryTable",props:m({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:s},null==(o=null==(e=null==(t=r)?void 0:t.BaseCrud)?void 0:e._components)?void 0:o.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(t,{expose:e,emit:o}){const s=t,r=o,a=c(),{handleScroll:u}=(()=>{let t=null,e=0;return p((()=>{null==t||t.scrollTo(0,e)})),{handleScroll:function(o,s){let r=o.target;if(s&&(r=r.querySelector(s)),!r)return;const{scrollTop:n}=r;!t&&(t=r),e=n}}})();let m=0,G=s.showSummary?2:1;const L=d(null),O=d([]),Q=j([]);f((()=>{const{cols:t,currPage:e,pageSize:o}=s,i=q(e,o),{index:l,sort:p,selection:u,operate:m}=i;R("index",s)&&t.unshift(l),R("sort",s)&&t.unshift(p),R("selection",s)&&t.unshift(u),R("operate",s)&&t.push(m);const c=t.map((t=>{if("Object"!==n(t))return 1;const{col:e,level:o}=E(t,1,i,"small"===a.size);return Q.push(e),o})),d=Math.max(...c);G+=d-1,r("update:cols",Q)}))();const I=h((()=>{const{showSummary:t,summaryMethod:e}=s;return Object.assign({maxHeight:`calc(100% + ${40*G}px)`,cellClassName(t){if("$sort"===t.column.property)return"sort-cell"}},P,{showSummary:t,summaryMethod:e})}));function N(t,{row:e,col:o,$index:s},n){r("groupBtn",t,{$index:s,...e},n)}function W(t){O.value=t;const e=t.map((t=>t[I.value.rowKey]));r("selectionChange",t,e)}function H(t,e){const{groupBtns:o=[],rows:r,filterBtnsByAuth:n}=s,i=n(T(t,e,o)),l=K(i);return e<r.length-1?m<l&&(m=l,Q.slice(-1)[0].minWidth=m):m<30&&(m=K(),Q.slice(-1)[0].minWidth=m),i}function K(t){if(!t)return 66;let e=0,o=0;const{groupBtnsAttrs:r={}}=s,{vertical:n,maxNum:a=l}=r;return t.length>a&&(t=t.slice(0,a-1).concat([{text:"更多"}])),n?t.forEach((t=>{e=i(t.text)+1;const s=12*e+6+24;s>o&&(o=s)})):(t.forEach((t=>{e+=i(t.text)+1})),o=12*e+3*t.length*2+12*(t.length-1)+24),o}return e({tableRef:L,clearSelection(){var t;return null==(t=null==L?void 0:L.value)?void 0:t.clearSelection()},allSelection(){var t;return null==(t=null==L?void 0:L.value)?void 0:t.toggleAllSelection()},invertSelection(){var t;null==(t=null==O?void 0:O.value)||t.forEach(((t,e)=>{var o;null==(o=null==L?void 0:L.value)||o.toggleRowSelection(t,!1)}))}}),(t,e)=>{const o=S("BaseEmpty"),s=S("el-table"),r=A("loading");return Q.length?g((y(),v(s,b({key:0,class:"query-table",data:t.rows,onSelectionChange:W,onScrollCapture:x(u)},I.value,{ref_key:"tableRef",ref:L}),_({default:B((()=>[(y(!0),k(z,null,$(Q,((e,o)=>(y(),v(F,{col:e,selection:t.selection,refreshList:t.refreshList,groupBtnsAttrs:t.groupBtnsAttrs,getGroupBtnsOfRow:H,onGroupBtn:N,disabled:t.disabled,key:o},{custom:B((({row:e,col:o,ind:s})=>[M(t.$slots,"custom",b({ref_for:!0},{row:e,col:o,$index:s}),void 0,!0)])),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"])))),128))])),_:2},[t.loading?void 0:{name:"empty",fn:B((()=>[C(o)])),key:"0"}]),1040,["data","onScrollCapture"])),[[r,t.loading]]):w("",!0)}}}),[["__scopeId","data-v-20ebc86f"]]);export{G as default};
