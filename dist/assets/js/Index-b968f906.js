var e,t;import{l as s}from"./lodash-e3f0fdcb.js";import{_ as o}from"./Index.vue_vue_type_script_setup_true_lang-6bedb48e.js";import a from"./QueryTable-34dcfa5b.js";import r from"./Index-a06b0cd5.js";import{g as n}from"./index-ab647bfb.js";import{i,d as l,a as p,b as u,c,o as m,p as d,e as g,t as f,r as _,s as j,f as v,g as h,_ as y}from"./index-df51bfa3.js";import"./dayjs-70c6b0b9.js";import{_ as b}from"./Pagination.vue_vue_type_script_setup_true_lang-f60474e2.js";import{g as B,h as x,b as z}from"./_utils-79545bed.js";import{S as w}from"./sortablejs-b0ad9b27.js";import{d as A,bd as C,e as S,$ as P,k as F,f as $,j as O,o as R,c as k,W as M,Q as q,M as I,J as D,P as E,T as V,u as N,D as Q,ad as U,ae as K}from"./@vue-2b5461a3.js";import"./call-bind-2df1f9b5.js";import"./get-intrinsic-176af07e.js";import"./es-errors-c8ed318b.js";import"./has-symbols-456daba2.js";import"./has-proto-c2a23985.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-af5653fd.js";import"./define-data-property-80a6b8d7.js";import"./es-define-property-c2edbfb6.js";import"./gopd-991ce5b0.js";import"./has-property-descriptors-52e43c9d.js";import"./@element-plus-df896130.js";import"./SetTable.vue_vue_type_script_setup_true_lang-9ac02e0b.js";import"./BaseTable-a0378fd1.js";import"./Column.vue_vue_type_script_name_Column_setup_true_lang-08309ecb.js";import"./GroupBtns-baf5df96.js";import"./vue-router-27db6c8e.js";import"./UserInfo-1d530967.js";import"./dict-map-b95c54a5.js";import"./nprogress-61860a65.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-170fc1f8.js";import"./_utils-931b8acf.js";import"./_config-0a862e30.js";import"./SetPrint-b48fbd4c.js";import"./BatchBtns.vue_vue_type_script_setup_true_lang-a0d6dec4.js";import"./QueryFields-90f0d468.js";import"./QueryBtns.vue_vue_type_style_index_0_lang-9eeda493.js";import"./_utils-0f2b9537.js";import"./_config-f68c3c0a.js";import"./element-plus-568f2232.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-2ec33eb0.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./qs-349681aa.js";import"./side-channel-4fcbcfeb.js";import"./object-inspect-1fd817f8.js";import"./axios-b9284f1b.js";import"./pinia-5cbb4d0f.js";import"./mock-281f81b0.js";import"./mockjs-21e11712.js";import"./vite-plugin-mock-fcfbfb18.js";import"./path-to-regexp-83a43451.js";import"./vue-i18n-aaa7cda4.js";import"./@intlify-34459bb4.js";import"./xlsx-8a748b86.js";import"./ImportPopup-34a61de7.js";const L=y(A({name:"BaseCrud",__name:"Index",props:C({modelValue:{},rowKey:{},formAttrs:{},tableAttrs:{},pageAttrs:{},disabled:{type:Boolean},groupBtnsAttrs:{},pagination:{type:[Boolean,Object]},fields:{},sections:{},cols:{},selectAll:{type:Boolean},fetch:{},fetchSuccess:{type:Function},fetchFail:{type:Function},immediate:{type:Boolean},extraBtns:{},groupBtns:{type:[Array,Function]},reqMap:{},resMap:{},showPagination:{type:Boolean},summaryList:{type:[Boolean,Function]},sort:{type:Boolean},index:{type:Boolean},selection:{type:Boolean},batchBtn:{type:Boolean},exportCfg:{},importCfg:{},extraParams:{},log:{type:Boolean},debug:{type:Boolean},isOmit:{type:Boolean},changeFetch:{type:Boolean},inputDebounce:{type:Boolean},filterByAuth:{type:Function},colSpanAttrs:{},compact:{type:Boolean},size:{},rowNum:{},handleRequest:{type:Function},handleResponse:{type:Function}},Object.assign({rowKey:"id",log:!i,fields:()=>[],cols:()=>[],immediate:!0,changeFetch:!0,batchBtn:!1,isOmit:!0,inputDebounce:!0,exportCfg:()=>({limit:1e4}),pagination:()=>({currPage:1,pageSize:20}),reqMap:()=>l,resMap:()=>p,showPagination:!0,colSpanAttrs:()=>u,compact:e=>e.colSpanAttrs.xl<6,filterByAuth:e=>!0},null==(t=null==(e=c)?void 0:e.BaseCrud)?void 0:t.Index)),emits:["update:modelValue","extraBtn","groupBtn","selectionChange","rows","dargSortEnd"],setup(e,{expose:t,emit:i}){const l=Q("openPopup"),p=S([]),u=e,c=i,y=Q("closePopup"),A=S(null),C=S(null),L=S(null),T=S(null),{reqMap:G,resMap:J,extraParams:H={}}=u,W=u.pagination?{[`${G.curr_page}`]:u.pagination.currPage,[`${G.page_size}`]:u.pagination.pageSize}:{},Y={...W,...H},Z=P(s.cloneDeep(W)),X=P({total:0,hasMore:!0}),ee=S(!1),te=S([]),se=S([]),oe=F({get:()=>u.modelValue,set(e){c("update:modelValue",e)}});let ae=s.cloneDeep(Y);const re=F((()=>{const{extraBtns:e=[],disabled:t}=u;return ve(e.map((e=>{var s;const o=n(e),{name:a,attrs:r,customRules:i}=o;return(null==(s=z)?void 0:s.includes(a))&&(o.popconfirm=!1,r.disabled=i?!X.total:!se.value.length),t&&(r.disabled=t),o})))})),ne=F((()=>!!re.value.find((e=>z.includes(e.name)&&!e.customRules)))),ie=F((()=>u.selection||ne.value)),le=S(u.cols.slice());function pe(){Object.assign(Z,W),ae=s.cloneDeep(Y),ge(ae,void 0,"reset")}function ue(e){Object.assign(ae,{[`${G.curr_page}`]:1}),ge(ae,void 0,"search")}function ce(e){Object.assign(ae,{[`${G.curr_page}`]:1,[`${G.page_size}`]:e}),ge(ae,void 0,"sizeChange")}function me(e){Object.assign(ae,{[`${G.curr_page}`]:e}),ge(ae,void 0,"currChange")}function de(e,t){const{immediate:o,changeFetch:a}=u;if(e=v(e),t)s.merge(ae,e),Object.assign(Y,ae);else{if(!a)return;Object.assign(ae,e,{[`${G.curr_page}`]:1})}o&&ge(ae,void 0,"change")}function ge(e=ae,t,s="expose"){const{fetch:o,handleRequest:a,isOmit:r,handleResponse:n,selectAll:i,summaryList:l,fetchSuccess:p,fetchFail:d,log:g}=u;o&&(ee.value=!0,a&&(e=a(e)),r&&(e=m(e)),g&&h(e,"req"),o(e).then((s=>{if(!s)return;n&&(s=n(s));const o=s[J.records];if(!o)return;g&&h(o,"res");const a=e[G.curr_page];if(l){const e=f(l),t=te.value;if("Boolean"===e)te.value=1===a?o:[...t,...o];else{if("Function"!==e)throw new Error(`暂未处理此种类型：${e}`);te.value=l(a,t,o)}}else te.value=o;Object.assign(X,{total:s[J.total_num],hasMore:s[J.has_more]}),Object.assign(Z,{[G.curr_page]:a,[G.page_size]:e[G.page_size]}),i&&(se.value=o),null==p||p(s),c("rows",te.value,e),null==t||t()})).catch((e=>{null==d||d(e)})).finally((()=>{ee.value=!1})))}function fe(e){const{rowKey:t,exportCfg:s,importCfg:o}=u,{text:a}=e;x({btnObj:e,cols:p.value,seledRows:se.value,seledKeys:se.value.map((e=>e[t])),total:X.total,exportCfg:s,emits:c,next:(e=`${a||"操作"}成功`,t,s,o=!0)=>{j(e),y(t),o&&he(),ie.value&&A.value.clearSelection(),null==s||s()},openPopup:l,importCfg:o})}function _e(e,t,s,o=!0){const{name:a,text:r}=e;c("groupBtn",a,t,((e,t,a)=>{s(e,t,a),o&&he()}))}function je(e,t){se.value=e,c("selectionChange",e,t)}function ve(e=[]){const{filterByAuth:t}=u;return t?e.filter((({auth:e})=>!(null==e?void 0:e.length)||t(e))):e}function he(e){ge(ae,e,"refresh")}return $((()=>u.extraParams),(e=>{s.merge(ae,e),ge(ae,void 0,"extraParams")}),{deep:!0}),O((()=>{u.sort&&function(e=A.value.tableRef.$el.querySelector(".el-table__body-wrapper tbody")){w.create(e,{handle:".sort-cell",animation:300,onEnd(e){const{newIndex:t,oldIndex:s}=e;"boolean"==typeof u.sort&&c("dargSortEnd",{newIndex:t,oldIndex:s},((e="修改排序成功")=>{j(e)}))}})}()})),t({refreshList:he,getList:ge,getQueryParams:(e=u.isOmit)=>e?m(ae):ae,getQueryFields(e=[G.curr_page,G.page_size]){const t=[],s=[],o=C.value.getFields();o.forEach((e=>{var t;(null==(t=e.prop)?void 0:t.includes(d))&&s.push(e.prop)}));for(const a in ae)if(e&&!e.includes(a)){const e=o.find((e=>e.prop===a));if(e){const s=ae[a];!g.includes(s)&&("Array"!==f(s)||s.some((e=>""!==e)))&&t.push({label:e.label,value:B(e,s)})}}return s.forEach((e=>{const[s,a]=e.split(d),r=ae[s],n=ae[a],i=o.find((t=>t.prop.includes(e)));i&&(r||n)&&t.push({label:i.label,value:[r,n].join(_)})})),t}}),(e,t)=>{var s;return R(),k("div",{class:"base-crud f-fs-s-c",ref_key:"baseCrudRef",ref:T},[M(r,I({class:["f-0","small"===e.size?"mb-6":"mb-h"],modelValue:oe.value,"onUpdate:modelValue":t[0]||(t[0]=e=>oe.value=e),disabled:e.disabled,fields:e.fields,sections:e.sections,loading:ee.value,inputDebounce:e.inputDebounce,colSpanAttrs:e.colSpanAttrs,compact:e.compact,onReset:pe,onSearch:ue,onChange:de,size:e.size,rowNum:e.rowNum},e.formAttrs,{ref_key:"queryFormRef",ref:C}),{custom:q((({field:t,form:s})=>[D(e.$slots,t.prop,{field:t,form:s},void 0,!0)])),_:3},16,["class","modelValue","disabled","fields","sections","loading","inputDebounce","colSpanAttrs","compact","size","rowNum"]),D(e.$slots,"middle",{},void 0,!0),re.value.length?(R(),E(o,{key:0,class:"f-0",columns:le.value,allColumns:p.value,btns:re.value,isEmpty:!(null==(s=te.value)?void 0:s.length),"onUpdate:cols":t[1]||(t[1]=e=>{le.value=e}),onClick:fe,total:X.total,batchBtn:e.batchBtn&&e.selection,size:e.size,ref_key:"extraBtnsRef",ref:L},null,8,["columns","allColumns","btns","isEmpty","total","batchBtn","size"])):V("",!0),D(e.$slots,"default",{loading:ee.value,rows:te.value,total:X.total,hasMore:X.hasMore,params:N(ae),onGroupBtn:_e},(()=>[M(a,I({groupBtnsAttrs:{compact:e.compact,small:"small"===e.size,...e.groupBtnsAttrs},loading:ee.value,cols:le.value,rows:te.value,total:X.total,sort:!!e.sort,index:e.index,selection:ie.value,groupBtns:e.groupBtns,currPage:e.pagination?Z[N(G).curr_page]:1,pageSize:e.pagination?Z[N(G).page_size]:20,filterBtnsByAuth:ve,refreshList:he,onGroupBtn:_e,onSelectionChange:je,"onUpdate:cols":t[2]||(t[2]=e=>{p.value=e}),disabled:e.disabled},e.tableAttrs,{size:e.size,ref_key:"queryTableRef",ref:A}),{custom:q((({row:t,col:s,$index:o})=>[D(e.$slots,s.prop,U(K({row:t,col:s,$index:o})),void 0,!0)])),_:3},16,["groupBtnsAttrs","loading","cols","rows","total","sort","index","selection","groupBtns","currPage","pageSize","disabled","size"])]),!0),e.pagination&&e.showPagination?(R(),E(b,I({key:1},e.pageAttrs,{currPage:Z[N(G).curr_page],"onUpdate:currPage":t[3]||(t[3]=e=>Z[N(G).curr_page]=e),pageSize:Z[N(G).page_size],"onUpdate:pageSize":t[4]||(t[4]=e=>Z[N(G).page_size]=e),total:X.total,onSizeChange:ce,onCurrentChange:me,small:"small"===e.size}),null,16,["currPage","pageSize","total","small"])):V("",!0)],512)}}}),[["__scopeId","data-v-674f3c8a"]]);export{L as default};
