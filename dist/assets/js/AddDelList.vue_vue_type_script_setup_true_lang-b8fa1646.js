import e from"./AddDelBtn-bca2ac7e.js";import{l as a}from"./lodash-e3f0fdcb.js";import{g as l,h as t}from"./_utils-0f2b9537.js";import{s as r}from"./index-df51bfa3.js";import"./dayjs-70c6b0b9.js";import{d as s,e as o,k as d,$ as m,f as u,ai as i,o as p,c as n,a9 as f,P as c,Q as v,F as g,M as y,W as j}from"./@vue-2b5461a3.js";const x=s({name:"AddDelList",__name:"AddDelList",props:{modelValue:{},parentProp:{default:""},fields:{default:()=>[]},pureText:{type:Boolean},formRef:{}},emits:["update:modelValue","change"],setup(s,{emit:x}){const V=s,h=x,k=o([]),$=l(V.fields),_=d({get:()=>V.modelValue,set(e){h("update:modelValue",e)}}),O=o([]),P=m({});return u((()=>V.fields),(e=>{const{modelValue:l}=V,r=t(e,h,l),{data:s,fields:o}=r;a.merge(P,s),O.value=o}),{immediate:!0}),u((()=>V.modelValue),(e=>{e.length<Object.keys(P).length?(Object.keys(P).forEach((e=>delete P[e])),a.merge(P,e)):a.merge(P,e)}),{immediate:!1,deep:!0}),u(P,(e=>{a.merge(V.modelValue,e)}),{immediate:!1,deep:!0}),(a,l)=>{const t=i("BaseFormItem"),s=i("el-form-item");return p(!0),n(g,null,f(_.value,((l,o)=>(p(),c(s,{style:{"margin-bottom":"18px",width:"100%"},key:o},{default:v((()=>[(p(!0),n(g,null,f(O.value,((e,l)=>{var r;return p(),c(t,y({prefixProp:`${a.parentProp}[${o}]`,field:e,pureText:(null==(r=e.extra)?void 0:r.pureText)||a.pureText,modelValue:_.value[o][e.prop],"onUpdate:modelValue":a=>_.value[o][e.prop]=a,className:"mr-o",ref_for:!0},e,{ref_for:!0,ref:e=>((e,a)=>{e&&(k.value[a]=e)})(e,o),key:l}),null,16,["prefixProp","field","pureText","modelValue","onUpdate:modelValue"])})),128)),j(e,{onClick:e=>function(e,a){if("add"===e){let e=function(){_.value.push(JSON.parse(JSON.stringify($)))};const{formRef:l}=V;if(l){const t=Object.keys(_.value[0]).map((e=>`${V.parentProp}[${a}].${e}`));l.validateField(t,((a,l)=>{if(a)e();else{const e=Object.values(l)[0][0];r(e.message,"error")}}))}else e()}else{if("del"!==e)throw new Error(`暂不支持${e}类型`);_.value.splice(a,1)}}(e,o),type:o<_.value.length-1?"del":"add"},null,8,["onClick","type"])])),_:2},1024)))),128)}}});export{x as _};
