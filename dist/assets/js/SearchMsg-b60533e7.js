import{M as s}from"./@element-plus-df896130.js";import{k as e,_ as o}from"./index-df51bfa3.js";import{c as r}from"./mock-82b0ce6c.js";import t from"./LoadMore-9a1497a0.js";import{E as i}from"./element-plus-568f2232.js";import{d as a,D as l,e as m,$ as n,w as p,ai as c,aq as d,o as u,c as j,R as f,W as v,u as h,Q as g,F as y,a9 as k,a as x,V as b}from"./@vue-2b5461a3.js";import"./dayjs-70c6b0b9.js";import"./call-bind-2df1f9b5.js";import"./get-intrinsic-176af07e.js";import"./es-errors-c8ed318b.js";import"./has-symbols-456daba2.js";import"./has-proto-c2a23985.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-af5653fd.js";import"./define-data-property-80a6b8d7.js";import"./es-define-property-c2edbfb6.js";import"./gopd-991ce5b0.js";import"./has-property-descriptors-52e43c9d.js";import"./lodash-e3f0fdcb.js";import"./qs-349681aa.js";import"./side-channel-4fcbcfeb.js";import"./object-inspect-1fd817f8.js";import"./axios-b9284f1b.js";import"./pinia-5cbb4d0f.js";import"./mock-281f81b0.js";import"./mockjs-21e11712.js";import"./vue-router-27db6c8e.js";import"./nprogress-61860a65.js";import"./vite-plugin-mock-fcfbfb18.js";import"./path-to-regexp-83a43451.js";import"./vue-i18n-aaa7cda4.js";import"./@intlify-34459bb4.js";import"./xlsx-8a748b86.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-2ec33eb0.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";const M={class:"search-msg f-fs-s-c"},U=["onClick"],C={class:"f-fs-c"},A={class:"nickname mr-o"},w={class:"time"},_=["innerHTML"],I=o(a({__name:"SearchMsg",props:{fromUser:{},toUser:{},keyWord:{}},emits:["select"],setup(o,{emit:a}){const I=l("closePopup"),W=o,L=a,V=m(W.keyWord),$=n({loading:!1,list:[],hasMore:!0,params:{prevCreatedAt:0,pageSize:15}});function q(s,o=`color:${e.colorPrimary};`){var r;const{msgContent:t}=s,i=null==(r=V.value)?void 0:r.trim();return t.Text.replaceAll(i,`<span style='${o}'>${i}</span>`)}function z(){Object.assign($,{list:[],prevCreatedAt:0,hasMore:!0})}function D(){var s,e;const{list:o}=$;$.params.prevCreatedAt=(null==(e=null==(s=o.slice(-1))?void 0:s[0])?void 0:e.createdAt)+1,H(V.value)}function H(s=""){if(!(s=null==s?void 0:s.trim()))return void z();const{fromUser:e,toUser:o}=W,{hasMore:t,list:a,params:l}=$,{prevCreatedAt:m}=l,n=0===m;n||t?($.loading=!0,r({fromUserId:e.id,toUserId:o.id,msgWord:s,isListReverse:0,...$.params}).then((s=>{const{fromUser:e,toUser:o}=W,{list:r,hasMore:t,fromUserId:i}=s,l=r.map(((s,r)=>(s.user=i===s.fromUserId?e:o,s)));Object.assign($,{list:n?l:a.concat(l),hasMore:t})})).finally((()=>{$.loading=!1}))):i.warning("底部没有更多了")}return p((()=>{H(W.keyWord)}))(),(e,o)=>{const r=c("el-input"),i=d("debounce"),a=d("focus");return u(),j("div",M,[f(v(r,{class:"mb-h f-0",modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=s=>V.value=s),placeholder:"请输入关键词",clearable:"",onClear:z,"suffix-icon":h(s)},null,8,["modelValue","suffix-icon"]),[[i,s=>{H(V.value)},"input"],[a]]),v(t,{loading:$.loading,class:"list",onReachBottom:D,"max-height":"calc(100vh - 200px)"},{default:g((()=>[(u(!0),j(y,null,k($.list,((s,e)=>(u(),j("div",{onClick:e=>{L("select",s,V.value,(()=>{I()}))},class:"item",key:e},[x("div",C,[x("b",A,b(s.user.nickname),1),x("time",w,b(s.createdDate),1)]),x("div",{class:"line-1",innerHTML:q(s)},null,8,_)],8,U)))),128))])),_:1},8,["loading"])])}}}),[["__scopeId","data-v-91d0ad07"]]);export{I as default};
