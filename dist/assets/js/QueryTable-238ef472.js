var t,e,o;import{L as s,c as r,t as n,M as a,N as l,_ as i}from"./index-06b7404a.js";import"./dayjs-21617033.js";import"./lodash-8dc1f9dc.js";import{bf as p,d as u,bd as m,a3 as c,e as d,$ as j,w as h,k as g,R as f,o as y,P as v,ab as _,Q as B,M as b,u as x,T as w,ai as S,aq as A,W as C,c as k,a9 as M,J as $,F as q}from"./@vue-2b5461a3.js";import"./nprogress-b5e58671.js";import{_ as z}from"./Column.vue_vue_type_script_name_Column_setup_true_lang-eed8fc0e.js";import{n as F,a as L}from"./_utils-6f1021aa.js";import{g as R,a as T}from"./_utils-9e79e638.js";import{d as E}from"./_config-0a862e30.js";import"./element-plus-ee430b3a.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-2ec33eb0.js";import"./@element-plus-c17b3efe.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./qs-238f3f4b.js";import"./call-bind-ada3a9fc.js";import"./get-intrinsic-176af07e.js";import"./es-errors-c8ed318b.js";import"./has-symbols-456daba2.js";import"./has-proto-c2a23985.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-968dc075.js";import"./define-data-property-9d7bf764.js";import"./es-define-property-c2edbfb6.js";import"./gopd-16a4ddf0.js";import"./has-property-descriptors-52e43c9d.js";import"./side-channel-5a41c40a.js";import"./object-inspect-0d550a97.js";import"./axios-b9284f1b.js";import"./pinia-5cbb4d0f.js";import"./mock-04205f76.js";import"./mockjs-217213d3.js";import"./vue-router-7f68ddec.js";import"./vite-plugin-mock-6db8ade2.js";import"./path-to-regexp-83a43451.js";import"./GroupBtns-aec86286.js";import"./index-194e202c.js";import"./UserInfo-2299b06c.js";import"./cascader-72ceb873.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-034f3f92.js";import"./system-ca7a6aa4.js";import"./xlsx-8a748b86.js";import"./ImportPopup-911a40be.js";const G=i(u({name:"QueryTable",__name:"QueryTable",props:m({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:s},null==(o=null==(e=null==(t=r)?void 0:t.BaseCrud)?void 0:e._components)?void 0:o.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(t,{expose:e,emit:o}){const s=t,r=o,i=c(),{handleScroll:u}=(()=>{let t=null,e=0;return p((()=>{null==t||t.scrollTo(0,e)})),{handleScroll:function(o,s){let r=o.target;if(s&&(r=r.querySelector(s)),!r)return;const{scrollTop:n}=r;!t&&(t=r),e=n}}})();let m=0,G=s.showSummary?2:1;const N=d(null),O=d([]),P=j([]);h((()=>{const{cols:t,currPage:e,pageSize:o}=s,a=R(e,o),{index:l,sort:p,selection:u,operate:m}=a;F("index",s)&&t.unshift(l),F("sort",s)&&t.unshift(p),F("selection",s)&&t.unshift(u),F("operate",s)&&t.push(m);const c=t.map((t=>{if("Object"!==n(t))return 1;const{col:e,level:o}=T(t,1,a,"small"===i.size);return P.push(e),o})),d=Math.max(...c);G+=d-1,r("update:cols",P)}))();const Q=g((()=>{const{showSummary:t,summaryMethod:e}=s;return Object.assign({maxHeight:`calc(100% + ${40*G}px)`,cellClassName(t){if("$sort"===t.column.property)return"sort-cell"}},E,{showSummary:t,summaryMethod:e})}));function I(t,{row:e,col:o,$index:s},n){r("groupBtn",t,{$index:s,...e},n)}function W(t){O.value=t;const e=t.map((t=>t[Q.value.rowKey]));r("selectionChange",t,e)}function J(t,e){const{groupBtns:o=[],rows:r,filterBtnsByAuth:n}=s,a=n(L(t,e,o)),l=D(a);return m<l&&(m=l,P.slice(-1)[0].minWidth=m),m<30&&e===r.length-1&&(m=D(),P.slice(-1)[0].minWidth=m),a}function D(t){if(!t)return 66;let e=0,o=0;const{groupBtnsAttrs:r={}}=s,{vertical:n,maxNum:i=l}=r;return t.length>i&&(t=t.slice(0,i-1).concat([{text:"更多"}])),n?t.forEach((t=>{e=a(t.text)+1;const s=12*e+6+24;s>o&&(o=s)})):(t.forEach((t=>{e+=a(t.text)+1})),o=12*e+3*t.length*2+12*(t.length-1)+24),o}return e({tableRef:N,clearSelection(){var t;return null==(t=null==N?void 0:N.value)?void 0:t.clearSelection()},allSelection(){var t;return null==(t=null==N?void 0:N.value)?void 0:t.toggleAllSelection()},invertSelection(){var t;null==(t=null==O?void 0:O.value)||t.forEach(((t,e)=>{var o;null==(o=null==N?void 0:N.value)||o.toggleRowSelection(t,!1)}))}}),(t,e)=>{const o=S("BaseEmpty"),s=S("el-table"),r=A("loading");return P.length?f((y(),v(s,b({key:0,class:"query-table",data:t.rows,onSelectionChange:W,onScrollCapture:x(u)},Q.value,{ref_key:"tableRef",ref:N}),_({default:B((()=>[(y(!0),k(q,null,M(P,((e,o)=>(y(),v(z,{col:e,selection:t.selection,refreshList:t.refreshList,groupBtnsAttrs:t.groupBtnsAttrs,getGroupBtnsOfRow:J,onGroupBtn:I,disabled:t.disabled,key:o},{custom:B((({row:e,col:o,ind:s})=>[$(t.$slots,"custom",b({ref_for:!0},{row:e,col:o,$index:s}),void 0,!0)])),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"])))),128))])),_:2},[t.loading?void 0:{name:"empty",fn:B((()=>[C(o)])),key:"0"}]),1040,["data","onScrollCapture"])),[[r,t.loading]]):w("",!0)}}}),[["__scopeId","data-v-141d0801"]]);export{G as default};
