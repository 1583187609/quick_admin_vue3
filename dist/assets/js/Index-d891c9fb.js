var e,t;import{l as s}from"./lodash-8dc1f9dc.js";import{_ as o}from"./Index.vue_vue_type_script_setup_true_lang-8dfa71be.js";import a from"./QueryTable-238ef472.js";import r from"./Index-0fa03e55.js";import{g as n}from"./index-194e202c.js";import{i,d as l,a as p,b as u,c,o as m,p as d,e as g,t as f,r as _,s as j,f as v,g as h,_ as y}from"./index-06b7404a.js";import"./dayjs-21617033.js";import{_ as b}from"./Pagination.vue_vue_type_script_setup_true_lang-fbee34b6.js";import{g as B,h as x,b as z}from"./_utils-6f1021aa.js";import{S as w}from"./sortablejs-b0ad9b27.js";import{d as A,bd as C,e as S,$ as P,k as F,f as $,j as O,o as R,c as k,W as q,Q as I,M,u as D,E,J as V,P as L,T as Q,D as U,ad as N,ae as T}from"./@vue-2b5461a3.js";import"./call-bind-ada3a9fc.js";import"./get-intrinsic-176af07e.js";import"./es-errors-c8ed318b.js";import"./has-symbols-456daba2.js";import"./has-proto-c2a23985.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-968dc075.js";import"./define-data-property-9d7bf764.js";import"./es-define-property-c2edbfb6.js";import"./gopd-16a4ddf0.js";import"./has-property-descriptors-52e43c9d.js";import"./@element-plus-c17b3efe.js";import"./SetTable.vue_vue_type_script_setup_true_lang-5cbe9b73.js";import"./BaseTable-8f9359e9.js";import"./Column.vue_vue_type_script_name_Column_setup_true_lang-eed8fc0e.js";import"./GroupBtns-aec86286.js";import"./vue-router-7f68ddec.js";import"./UserInfo-2299b06c.js";import"./cascader-72ceb873.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-034f3f92.js";import"./_utils-9e79e638.js";import"./_config-0a862e30.js";import"./SetPrint-74bb328b.js";import"./BatchBtns.vue_vue_type_script_setup_true_lang-91939509.js";import"./nprogress-b5e58671.js";import"./QueryFields-86f64458.js";import"./QueryBtns.vue_vue_type_style_index_0_lang-4ecf043c.js";import"./_utils-e15a3336.js";import"./system-ca7a6aa4.js";import"./xlsx-8a748b86.js";import"./_config-7f8a0c8d.js";import"./element-plus-ee430b3a.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-2ec33eb0.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-36fbce82.js";import"./qs-238f3f4b.js";import"./side-channel-5a41c40a.js";import"./object-inspect-0d550a97.js";import"./axios-b9284f1b.js";import"./pinia-5cbb4d0f.js";import"./mock-04205f76.js";import"./mockjs-217213d3.js";import"./vite-plugin-mock-6db8ade2.js";import"./path-to-regexp-83a43451.js";import"./ImportPopup-911a40be.js";const G=y(A({name:"BaseCrud",__name:"Index",props:C({modelValue:{},rowKey:{},formAttrs:{},tableAttrs:{},pageAttrs:{},disabled:{type:Boolean},groupBtnsAttrs:{},pagination:{type:[Boolean,Object]},fields:{},sections:{},cols:{},selectAll:{type:Boolean},fetch:{},fetchSuccess:{type:Function},fetchFail:{type:Function},immediate:{type:Boolean},extraBtns:{},groupBtns:{type:[Array,Function]},reqMap:{},resMap:{},showPagination:{type:Boolean},summaryList:{type:[Boolean,Function]},sort:{type:Boolean},index:{type:Boolean},selection:{type:Boolean},batchBtn:{type:Boolean},exportCfg:{},importCfg:{},extraParams:{},log:{type:Boolean},debug:{type:Boolean},isOmit:{type:Boolean},changeFetch:{type:Boolean},inputDebounce:{type:Boolean},filterByAuth:{type:Function},colSpanAttrs:{},compact:{type:Boolean},size:{},rowNum:{},handleRequest:{type:Function},handleResponse:{type:Function}},Object.assign({rowKey:"id",log:!i,fields:()=>[],cols:()=>[],immediate:!0,changeFetch:!0,batchBtn:!1,isOmit:!0,inputDebounce:!0,exportCfg:()=>({limit:1e4}),pagination:()=>({currPage:1,pageSize:20}),reqMap:l,resMap:p,showPagination:!0,colSpanAttrs:u,compact:e=>e.colSpanAttrs.xl<6,filterByAuth:e=>!0},null==(t=null==(e=c)?void 0:e.BaseCrud)?void 0:t.Index)),emits:["update:modelValue","extraBtn","groupBtn","selectionChange","rows","dargSortEnd"],setup(e,{expose:t,emit:i}){const l=U("openPopup"),p=S([]),u=e,c=i,y=U("closePopup"),A=S(null),C=S(null),G=S(null),K=S(null),{reqMap:J,resMap:W,extraParams:H={}}=u,X=u.pagination?{[`${J.curr_page}`]:u.pagination.currPage,[`${J.page_size}`]:u.pagination.pageSize}:{},Y={...X,...H},Z=P(s.cloneDeep(X)),ee=P({total:0,hasMore:!0}),te=S(!1),se=S([]),oe=S([]);let ae=F({get:()=>u.modelValue,set(e){c("update:modelValue",e)}}),re=s.cloneDeep(Y);const ne=F((()=>{const{extraBtns:e=[],disabled:t}=u;return he(e.map((e=>{var s;const o=n(e),{name:a,attrs:r,customRules:i}=o;return(null==(s=z)?void 0:s.includes(a))&&(o.popconfirm=!1,r.disabled=i?!ee.total:!oe.value.length),t&&(r.disabled=t),o})))})),ie=F((()=>!!ne.value.find((e=>z.includes(e.name)&&!e.customRules)))),le=F((()=>u.selection||ie.value)),pe=S(u.cols.slice());function ue(){Object.assign(Z,X),re=s.cloneDeep(Y),fe(re,void 0,"reset")}function ce(e){Object.assign(re,{[`${J.curr_page}`]:1}),fe(re,void 0,"search")}function me(e){Object.assign(re,{[`${J.curr_page}`]:1,[`${J.page_size}`]:e}),fe(re,void 0,"sizeChange")}function de(e){Object.assign(re,{[`${J.curr_page}`]:e}),fe(re,void 0,"currChange")}function ge(e,t){const{immediate:o,changeFetch:a}=u;if(e=v(e),t)s.merge(re,e),Object.assign(Y,re);else{if(!a)return;Object.assign(re,e,{[`${J.curr_page}`]:1})}o&&fe(re,void 0,"change")}function fe(e=re,t,s="expose"){const{fetch:o,handleRequest:a,isOmit:r,handleResponse:n,selectAll:i,summaryList:l,fetchSuccess:p,fetchFail:d,log:g}=u;o&&(te.value=!0,a&&(e=a(e)),r&&(e=m(e)),g&&h(e,"req"),o(e).then((s=>{if(!s)return;n&&(s=n(s));let o=s[W.records];if(!o)return;g&&h(o,"res");const a=e[J.curr_page];if(l){const e=f(l),t=se.value;if("Boolean"===e)se.value=1===a?o:[...t,...o];else{if("Function"!==e)throw new Error(`暂未处理此种类型：${e}`);se.value=l(a,t,o)}}else se.value=o;Object.assign(ee,{total:s[W.total_num],hasMore:s[W.has_more]}),Object.assign(Z,{[J.curr_page]:a,[J.page_size]:e[J.page_size]}),i&&(oe.value=o),null==p||p(s),c("rows",se.value,e),null==t||t()})).catch((e=>{null==d||d(e)})).finally((()=>{te.value=!1})))}function _e(e){const{rowKey:t,exportCfg:s,importCfg:o}=u,{text:a}=e;x({btnObj:e,cols:p.value,seledRows:oe.value,seledKeys:oe.value.map((e=>e[t])),total:ee.total,exportCfg:s,emits:c,next:(e=`${a||"操作"}成功`,t,s,o=!0)=>{j(e),y(t),o&&ye(),le.value&&A.value.clearSelection(),null==s||s()},openPopup:l,importCfg:o})}function je(e,t,s,o=!0){const{name:a,text:r}=e;c("groupBtn",a,t,((e,t,a)=>{s(e,t,a),o&&ye()}))}function ve(e,t){oe.value=e,c("selectionChange",e,t)}function he(e=[]){const{filterByAuth:t}=u;return t?e.filter((({auth:e})=>!(null==e?void 0:e.length)||t(e))):e}function ye(e){fe(re,e,"refresh")}return $((()=>u.extraParams),(e=>{s.merge(re,e),fe(re,void 0,"extraParams")}),{deep:!0}),O((()=>{u.sort&&function(e=A.value.tableRef.$el.querySelector(".el-table__body-wrapper tbody")){w.create(e,{handle:".sort-cell",animation:300,onEnd(e){const{newIndex:t,oldIndex:s}=e;"boolean"==typeof u.sort&&c("dargSortEnd",{newIndex:t,oldIndex:s},((e="修改排序成功")=>{j(e)}))}})}()})),t({refreshList:ye,getList:fe,getQueryParams:(e=u.isOmit)=>e?m(re):re,getQueryFields(e=[J.curr_page,J.page_size]){const t=[],s=[],o=C.value.getFields();o.forEach((e=>{var t;(null==(t=e.prop)?void 0:t.includes(d))&&s.push(e.prop)}));for(const a in re)if(e&&!e.includes(a)){const e=o.find((e=>e.prop===a));if(e){const s=re[a];!g.includes(s)&&("Array"!==f(s)||s.some((e=>""!==e)))&&t.push({label:e.label,value:B(e,s)})}}return s.forEach((e=>{const[s,a]=e.split(d),r=re[s],n=re[a],i=o.find((t=>t.prop.includes(e)));i&&(r||n)&&t.push({label:i.label,value:[r,n].join(_)})})),t}}),(e,t)=>{var s;return R(),k("div",{class:"base-crud f-fs-s-c",ref_key:"baseCrudRef",ref:K},[q(r,M({class:["f-0","small"===e.size?"mb-6":"mb-h"],modelValue:D(ae),"onUpdate:modelValue":t[0]||(t[0]=e=>E(ae)?ae.value=e:ae=e),disabled:e.disabled,fields:e.fields,sections:e.sections,loading:te.value,inputDebounce:e.inputDebounce,colSpanAttrs:e.colSpanAttrs,compact:e.compact,onReset:ue,onSearch:ce,onChange:ge,size:e.size,rowNum:e.rowNum},e.formAttrs,{ref_key:"queryFormRef",ref:C}),{custom:I((({field:t,form:s})=>[V(e.$slots,t.prop,{field:t,form:s},void 0,!0)])),_:3},16,["class","modelValue","disabled","fields","sections","loading","inputDebounce","colSpanAttrs","compact","size","rowNum"]),V(e.$slots,"middle",{},void 0,!0),ne.value.length?(R(),L(o,{key:0,class:"f-0",columns:pe.value,allColumns:p.value,btns:ne.value,isEmpty:!(null==(s=se.value)?void 0:s.length),"onUpdate:cols":t[1]||(t[1]=e=>{pe.value=e}),onClick:_e,total:ee.total,batchBtn:e.batchBtn&&e.selection,size:e.size,ref_key:"extraBtnsRef",ref:G},null,8,["columns","allColumns","btns","isEmpty","total","batchBtn","size"])):Q("",!0),V(e.$slots,"default",{loading:te.value,rows:se.value,total:ee.total,hasMore:ee.hasMore,params:D(re),onGroupBtn:je},(()=>[q(a,M({groupBtnsAttrs:{compact:e.compact,small:"small"===e.size,...e.groupBtnsAttrs},loading:te.value,cols:pe.value,rows:se.value,total:ee.total,sort:!!e.sort,index:e.index,selection:le.value,groupBtns:e.groupBtns,currPage:e.pagination?Z[D(J).curr_page]:1,pageSize:e.pagination?Z[D(J).page_size]:20,filterBtnsByAuth:he,refreshList:ye,onGroupBtn:je,onSelectionChange:ve,"onUpdate:cols":t[2]||(t[2]=e=>{p.value=e}),disabled:e.disabled},e.tableAttrs,{size:e.size,ref_key:"queryTableRef",ref:A}),{custom:I((({row:t,col:s,$index:o})=>[V(e.$slots,s.prop,N(T({row:t,col:s,$index:o})),void 0,!0)])),_:3},16,["groupBtnsAttrs","loading","cols","rows","total","sort","index","selection","groupBtns","currPage","pageSize","disabled","size"])]),!0),e.pagination&&e.showPagination?(R(),L(b,M({key:1},e.pageAttrs,{currPage:Z[D(J).curr_page],"onUpdate:currPage":t[3]||(t[3]=e=>Z[D(J).curr_page]=e),pageSize:Z[D(J).page_size],"onUpdate:pageSize":t[4]||(t[4]=e=>Z[D(J).page_size]=e),total:ee.total,onSizeChange:me,onCurrentChange:de,small:"small"===e.size}),null,16,["currPage","pageSize","total","small"])):Q("",!0)],512)}}}),[["__scopeId","data-v-d569ad57"]]);export{G as default};
