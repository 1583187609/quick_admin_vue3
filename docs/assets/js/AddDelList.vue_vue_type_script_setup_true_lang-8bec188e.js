import e from"./AddDelBtn-864198b5.js";import{l as a}from"./lodash-8dc1f9dc.js";import{g as l,h as t}from"./_utils-1bd4f08a.js";import{s}from"./index-9d680563.js";import"./dayjs-21617033.js";import{d as r,e as o,k as d,$ as m,f as u,ai as i,o as p,c as n,a9 as f,P as c,Q as v,F as g,M as x,W as h}from"./@vue-2b5461a3.js";const j=r({name:"AddDelList",__name:"AddDelList",props:{modelValue:{},parentProp:{default:""},fields:{default:()=>[]},pureText:{type:Boolean},formRef:{}},emits:["update:modelValue","change"],setup(r,{emit:j}){const y=r,V=j,k=o([]),$=l(y.fields),_=d({get:()=>y.modelValue,set(e){V("update:modelValue",e)}}),O=o([]),P=m({});return u((()=>y.fields),(e=>{const{modelValue:l}=y,s=t(e,V,l),{data:r,fields:o}=s;a.merge(P,r),O.value=o}),{immediate:!0}),u((()=>y.modelValue),(e=>{e.length<Object.keys(P).length?(Object.keys(P).forEach((e=>delete P[e])),a.merge(P,e)):a.merge(P,e)}),{immediate:!1,deep:!0}),u(P,(e=>{a.merge(y.modelValue,e)}),{immediate:!1,deep:!0}),(a,l)=>{const t=i("BaseFormItem"),r=i("el-form-item");return p(!0),n(g,null,f(_.value,((l,o)=>(p(),c(r,{style:{"margin-bottom":"18px",width:"100%"},key:o},{default:v((()=>[(p(!0),n(g,null,f(O.value,((e,l)=>{var s;return p(),c(t,x({prefixProp:`${a.parentProp}[${o}]`,field:e,pureText:(null==(s=e.extra)?void 0:s.pureText)||a.pureText,modelValue:_.value[o][e.prop],"onUpdate:modelValue":a=>_.value[o][e.prop]=a,className:"mr-o",ref_for:!0},e,{ref_for:!0,ref:e=>((e,a)=>{e&&(k.value[a]=e)})(e,o),key:l}),null,16,["prefixProp","field","pureText","modelValue","onUpdate:modelValue"])})),128)),h(e,{onClick:e=>function(e,a){if("add"===e){let e=function(){_.value.push(JSON.parse(JSON.stringify($)))};const{formRef:l}=y;if(l){const t=Object.keys(_.value[0]).map((e=>`${y.parentProp}[${a}].${e}`));l.validateField(t,((a,l)=>{if(a)e();else{const e=Object.values(l)[0][0];s(e.message,"error")}}))}else e()}else{if("del"!==e)throw new Error(`暂不支持${e}类型`);_.value.splice(a,1)}}(e,o),type:o<_.value.length-1?"del":"add"},null,8,["onClick","type"])])),_:2},1024)))),128)}}});export{j as _};
